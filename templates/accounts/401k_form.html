<!-- 401k Account Form -->
<form id="401kAccountForm" onsubmit="submitAccountForm(event, '401K')">
    <input type="hidden" id="401kAccountId" name="account_id">

    <div class="row">
        <div class="col-md-6">
            <div class="mb-3">
                <label for="401kAccountName" class="form-label">Account Name *</label>
                <input type="text" class="form-control" id="401kAccountName" name="name" required
                    placeholder="e.g., Company 401k">
                <div class="form-text">A descriptive name for this 401k account</div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="mb-3">
                <label for="401kInstitution" class="form-label">Institution/Provider *</label>
                <input type="text" class="form-control" id="401kInstitution" name="institution" required
                    placeholder="e.g., Fidelity, Vanguard">
                <div class="form-text">401k plan provider or institution</div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="mb-3">
                <label for="401kCurrentBalance" class="form-label">Current Balance *</label>
                <div class="input-group">
                    <span class="input-group-text">$</span>
                    <input type="number" class="form-control" id="401kCurrentBalance" name="current_balance" required
                        min="0" step="0.01" placeholder="75000.00">
                </div>
                <div class="form-text">Total current account value</div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="mb-3">
                <label for="401kEmployerMatch" class="form-label">Employer Match *</label>
                <div class="input-group">
                    <input type="number" class="form-control" id="401kEmployerMatch" name="employer_match" required
                        min="0" max="100" step="0.01" placeholder="4.00">
                    <span class="input-group-text">%</span>
                </div>
                <div class="form-text">Employer matching percentage</div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="mb-3">
                <label for="401kContributionLimit" class="form-label">Annual Contribution Limit *</label>
                <div class="input-group">
                    <span class="input-group-text">$</span>
                    <input type="number" class="form-control" id="401kContributionLimit" name="contribution_limit"
                        required min="0" step="1" placeholder="23000">
                </div>
                <div class="form-text">IRS annual contribution limit for current year</div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="mb-3">
                <label for="401kEmployerContribution" class="form-label">Employer Contribution *</label>
                <div class="input-group">
                    <span class="input-group-text">$</span>
                    <input type="number" class="form-control" id="401kEmployerContribution" name="employer_contribution"
                        required min="0" step="0.01" placeholder="3000.00">
                </div>
                <div class="form-text">Annual employer contribution amount</div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="mb-3">
                <label for="401kVestingSchedule" class="form-label">Vesting Schedule (Optional)</label>
                <select class="form-select" id="401kVestingSchedule" name="vesting_schedule">
                    <option value="">Select vesting schedule</option>
                    <option value="immediate">Immediate (100%)</option>
                    <option value="graded_3">3-Year Graded</option>
                    <option value="graded_6">6-Year Graded</option>
                    <option value="cliff_3">3-Year Cliff</option>
                    <option value="cliff_5">5-Year Cliff</option>
                </select>
                <div class="form-text">Employer contribution vesting schedule</div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="mb-3">
                <label for="401kYearsOfService" class="form-label">Years of Service (Optional)</label>
                <input type="number" class="form-control" id="401kYearsOfService" name="years_of_service" min="0"
                    step="0.1" placeholder="2.5">
                <div class="form-text">Years with current employer for vesting calculation</div>
            </div>
        </div>
    </div>

    <div class="alert alert-info">
        <i class="fas fa-info-circle me-2"></i>
        <strong>401k Account Information:</strong> 401k accounts are employer-sponsored retirement plans with
        tax advantages. Contributions may be pre-tax or Roth (after-tax).
    </div>

    <!-- Contribution Analysis -->
    <div class="card bg-light mb-3">
        <div class="card-body">
            <h6 class="card-title">Contribution Analysis</h6>
            <div class="row">
                <div class="col-md-4">
                    <strong>Max Employee Contribution</strong>
                    <div id="maxEmployeeContribution" class="h5 text-primary">$0</div>
                </div>
                <div class="col-md-4">
                    <strong>Max Employer Match</strong>
                    <div id="maxEmployerMatch" class="h5 text-success">$0</div>
                </div>
                <div class="col-md-4">
                    <strong>Total Max Annual</strong>
                    <div id="totalMaxAnnual" class="h5 text-info">$0</div>
                </div>
            </div>
            <div class="mt-2">
                <small class="text-muted">
                    Based on current contribution limits and employer match percentage
                </small>
            </div>
        </div>
    </div>

    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="submit" class="btn btn-primary">
            <i class="fas fa-save me-2"></i><span id="401kSubmitText">Save 401k Account</span>
        </button>
    </div>
</form>

<script>
    // Auto-calculate contribution analysis
    document.getElementById('401kContributionLimit').addEventListener('input', calculate401kAnalysis);
    document.getElementById('401kEmployerMatch').addEventListener('input', calculate401kAnalysis);
    document.getElementById('401kCurrentBalance').addEventListener('input', calculate401kAnalysis);

    function calculate401kAnalysis() {
        const contributionLimit = parseFloat(document.getElementById('401kContributionLimit').value) || 0;
        const employerMatch = parseFloat(document.getElementById('401kEmployerMatch').value) || 0;
        const currentBalance = parseFloat(document.getElementById('401kCurrentBalance').value) || 0;

        // Estimate annual salary based on typical contribution patterns (rough estimate)
        const estimatedSalary = currentBalance > 0 ? Math.max(50000, currentBalance * 0.8) : 100000;

        const maxEmployerMatch = estimatedSalary * (employerMatch / 100);
        const totalMaxAnnual = contributionLimit + maxEmployerMatch;

        document.getElementById('maxEmployeeContribution').textContent = '$' + contributionLimit.toLocaleString();
        document.getElementById('maxEmployerMatch').textContent = '$' + maxEmployerMatch.toLocaleString();
        document.getElementById('totalMaxAnnual').textContent = '$' + totalMaxAnnual.toLocaleString();
    }

    // Set default contribution limit for current year
    document.addEventListener('DOMContentLoaded', function () {
        if (!document.getElementById('401kContributionLimit').value) {
            document.getElementById('401kContributionLimit').value = '23000'; // 2024 limit
            calculate401kAnalysis();
        }
    });
</script>